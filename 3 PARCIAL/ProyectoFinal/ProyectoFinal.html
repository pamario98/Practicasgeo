
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PROYECO FINAL</title>
    
        <!-- Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    
        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        
        <style>
            img {
                width: 80%;
            }
    
            .logged-in, .logged-out {
                display: none;


            }

        html, body {
            margin: 0px;
            padding: 0px;
        }

        #map {
            width: 100%;
            height: 500px;
        }

        #map1 {
            width: 100%;
            height: 500px;
        }


        </style>
    </head>
    <div class="p-3 mb-2 bg-dark text-white">
    <body class="bg-light">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">TIENDA APPLE</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                <a class="nav-item nav-link logged-in" href="#" data-toggle="modal" data-target="#micuentamodal">Mi Cuenta</a>
                <a class="nav-item nav-link logged-in" href="#" id="salir">Salir</a>
                <a class="nav-item nav-link logged-out" href="#" data-toggle="modal" data-target="#ingresarmodal">Ingresar</a>
                <a class="nav-item nav-link logged-out" href="#" data-toggle="modal" data-target="#registratemodal">Regístrate</a>
                </div>
            </div>
        </nav>
        <div class="p-3 mb-2 bg-dark text-white">
            <div class="container-fluid">
                <div class="row">
                  <div class="col-12 col-md-6">
                      <div id="map"></div>
                  </div>
                  <div class="col-12 col-md-6">
                    <h1 style="color: blue;">Apple Store Para Soporte</h1>
                    <div id="datos"></div>
                  </div>
                </div>
            </div>
            
          </div>

          <div class="container-fluid">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div id="map1"></div>
                    </div>
                        <div class="col-12 col-md-6">
                       <h2 align="center">Muestra tu ubicacion en color azul y muestra la ubicacion de las tiendas donde estan los productos</h2>
                       <h3 align="center" style="color:blue;">Nota: Lo del color azul de tu ubicacion exacta solo funciona en Google Chrome</h3>
                       
                    </div>
                </div>
            </div>
       
         
     
    </div>
        <!-- Modal Ingresar -->
        <div class="modal fade" id="ingresarmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="ingresarModalLabel">Ingresar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <form id="formaingresar">
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="email" class="form-control" required id="correo" placeholder="Ingrese su correo electrónico">
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="password" class="form-control" required id="contrasena" placeholder="Ingrese su contraseña">
                            </div>
                        </div>
                        <div class="row text-center">
                            <div class="col-12">
                                <input type="submit" class="btn btn-primary" value="Ingresar">
                                <p class="error text-danger"></p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="row">
                    <div class="col-12 text-center">
                        <span onclick="entrarGoogle()" class="btn btn-primary btn-danger">Continuar con Gmail <i class="fas fa-plus"></i></span>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
            </div>
        </div>
    
    
        <!-- Modal Registrate -->
        <div class="modal fade" id="registratemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="registrateModalLabel">Regístrate</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <form id="formaregistrate" autocomplete="off">
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="text" class="form-control" id="rnombre" required placeholder="Ingrese su nombre completo">
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="email" class="form-control" id="rcorreo" required placeholder="Ingrese su correo electrónico">
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="text" class="form-control" id="rcontrasena" required placeholder="Ingrese su contraseña">
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="number" step="any" class="form-control" id="rtelefono" required placeholder="Ingrese su teléfono">
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-12">
                                <input type="text" class="form-control" id="rdireccion" required placeholder="Ingrese su dirección">
                            </div>
                        </div>
                        <div class="row text-center">
                            <div class="col-12">
                                <input type="submit" class="btn btn-primary">
                                <p class="error text-danger"></p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
            </div>
        </div>
    
        <!-- Modal MiCuenta -->
        <div class="modal fade" id="micuentamodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="micuentaModalLabel">Mi Cuenta</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <div class="row m-2">
                        <div class="col-12 datosdelacuenta" >
                            Aquí va la info de su cuenta
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
            </div>
        </div>
    
        <div class="container">
            <div class="row text-center" id="listadeProductoApples">
            </div>
        </div>
    
    
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
    
        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
    
        <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyApiNJM9D9AZWr8NyBBJUNUkLE0IHLn_z4",
            authDomain: "practica1-e4a9c.firebaseapp.com",
            projectId: "practica1-e4a9c",
            storageBucket: "practica1-e4a9c.appspot.com",
            messagingSenderId: "884279253860",
            appId: "1:884279253860:web:96a6d4730015b54d03f871",
            measurementId: "G-RW2J4PHT22"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    
        const auth = firebase.auth();
    
        const db = firebase.firestore();




        function iniciaMapa(){

                if(navigator.geolocation){

                    navigator.geolocation.getCurrentPosition( position => {

                        let posicion = {
                        
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        }

                        let propiedadesMarcador = {
                            position: posicion,
                            icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                        },
                            map,
                            title: "Marcardor PRINCIPAL"
                        }

                        const marcador = new google.maps.Marker(propiedadesMarcador);

                        map.setCenter(posicion)

                        const infowindow = new google.maps.InfoWindow({
                            content : informacion1
                        })

                        marcador.addListener("click", ()=>{
                            infowindow.open(map,marcador);
                        })
                        

                    })
                    }         

                        var propiedades = {
                        zoom: 12,
                    };

                    const mapa = document.getElementById("map1");
                    const map = new google.maps.Map(mapa, propiedades);

                    let=i=0;
                    while(i<datos.length){

                    let d=datos[i];
                    let index;

                        let propiedadesMarcador = {
                        position: d.posicion,
                        map,
                        title: `Marcardor ${index}`,
                        };

                        let marcador = new google.maps.Marker(propiedadesMarcador);

                        map.setCenter(d.posicion);

                        let infowindow = new google.maps.InfoWindow({
                        content: retornarString(d.titulo, d.direccion, d.telefono),
                        });

                        marcador.addListener("click", () => {
                        infowindow.open(map, marcador);
                        });

                        i++;

                    }  




                    
            var coordenadas = {  lat: 21.152639, lng:  -101.711598 };

            var propiedades = {
                center: coordenadas,
                zoom: 6,
                mapTypeId: 'terrain'
            };

           map = new google.maps.Map(document.getElementById('map'),propiedades);

      

            fetch('applestore.json')
            .then( function(response){
                response.json().then( function(applestore){
                
                

                var datos = document.getElementById('datos');

                var tabla = `
                <table class="table table-striped">
                    <thead>
                    <tr class="table-success">
                        <th scope="col">Municipio</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Reservas Hechas</th>
                    </tr>
                    </thead>
                    <tbody>
                `;


                var coordenadasVuelos=[];

                applestore.forEach( municipio => {


                    coordenadasVuelos.push(municipio.coordenadas);

                    var municipioCirculo = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity : 0.8,
                    strokeWeight : 2,
                    fillColor: '#FF0000',
                    fillOpacity : 0.35,
                    map: map,
                    center: municipio.coordenadas,
                    radius: Math.sqrt(municipio.reservas) * 10
                    });

                    tabla += `
                    <tr>
                        <th scope="row" class="table-info">${ municipio.nombre}</th>
                        <td class="table-info">${ municipio.estado}</td>
                        <td class="table-info">${ municipio.reservas}</td>
                    </tr>
                    `;


                });

                var vuelosTrazo = new google.maps.Polyline({
                    path: coordenadasVuelos,
                    geodesic:true,
                    strokeColor: '#CCCCCC',
                    strokeOpacity: 0.5,
                    strokeColor: 1
                });

                vuelosTrazo.setMap(map);

                tabla +=`  
                    </tbody>
                    </table>`;

                datos.innerHTML = tabla;

                });
            });


            }


    
        </script>
    
        <script src="./autorizacion.js"></script>
        <script src="./index.js"></script>
        <script src="./Ubicacionstore.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJ3CV9YNn72DPSDkUZFU-joV6JQsO64qc&libraries=places&callback=iniciaMapa" async defer></script>
        
    </body>
    </html>